/* SCEditor v1.5.2 | (C) 2017, Sam Clarke | sceditor.com/license */

!function(e){"use strict";function t(e,t){return typeof t===e}function n(e){return!Object.keys(e).length}function o(e,t){for(var n=e===!!e,i=n?2:1,r=n?t:e,l=!!n&&e;i<arguments.length;i++){var a=arguments[i];for(var s in a){var c=a[s];if(!ae(c)){var u=null!==c&&"object"==typeof c,d=Array.isArray(c);r[s]=l&&(u||d)?o(!0,r[s]||(d?[]:{}),c):c}}}return r}function i(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}function r(e,t){if(Array.isArray(e)||"length"in e&&ce(e.length))for(var n=0;n<e.length;n++)t(n,e[n]);else Object.keys(e).forEach(function(n){t(n,e[n])})}function l(e){return e=parseFloat(e),isFinite(e)?e:0}function a(e,t,n){var o=(n||document).createElement(e);return r(t||{},function(e,t){"style"===e?o.style.cssText=t:e in o?o[e]=t:o.setAttribute(e,t)}),o}function s(e,t){for(var n=[],o=e||{};(o=o.parentNode)&&!/(9|11)/.test(o.nodeType);)t&&!C(o,t)||n.push(o);return n}function c(e,t){for(var n=e||{};(n=n.parentNode)&&!/(9|11)/.test(n.nodeType);)if(!t||C(n,t))return n}function u(e,t){return C(e,t)?e:c(e,t)}function d(e){e.parentNode.removeChild(e)}function f(e,t){e.appendChild(t)}function p(e,t){return e.querySelectorAll(t)}function h(e,t,n,o,i){t.split(" ").forEach(function(t){var r;le(n)?(r=o["_sce-event-"+t+n]||function(t){for(var i=t.target;i&&i!==e;){if(C(i,n))return void o.call(i,t);i=i.parentNode}},o["_sce-event-"+t+n]=r):(r=n,i=o),e.addEventListener(t,r,i||!1)})}function m(e,t,n,o,i){t.split(" ").forEach(function(t){var r;le(n)?r=o["_sce-event-"+t+n]:(r=n,i=o),e.removeEventListener(t,r,i||!1)})}function g(e,t,n){if(arguments.length<3)return e.getAttribute(t);null==n?v(e,t):e.setAttribute(t,n)}function v(e,t){e.removeAttribute(t)}function b(e){w(e,"display","none")}function y(e){w(e,"display","")}function x(e){I(e)?b(e):y(e)}function w(e,t,n){if(arguments.length<3){if(le(t))return getComputedStyle(e)[t];r(t,function(t,n){w(e,t,n)})}else{var o=(n||0===n)&&!isNaN(n);e.style[t]=o?n+"px":n}}function k(e,t,n){var o=arguments.length,i={};if(e.nodeType===ge){if(1===o)return r(e.attributes,function(e,t){/^data\-/i.test(t.name)&&(i[t.name.substr(5)]=t.value)}),i;if(2===o)return g(e,"data-"+t);g(e,"data-"+t,String(n))}}function C(e,t){var n=!1;if(e&&e.nodeType===ge){var o,i,r,l=e.ownerDocument;de<10&&!e.document&&(r=!0,o=e.parentNode,i=e.nextSibling,f(l.body,e)),n=(e.matches||e.msMatchesSelector||e.webkitMatchesSelector).call(e,t),r&&(d(e),o&&o.insertBefore(e,i))}return n}function E(e,t){return e!==t&&e.contains&&e.contains(t)}function S(e,t){var n=e.previousElementSibling;return t&&n?C(n,t)?n:null:n}function T(e,t){return t.parentNode.insertBefore(e,t)}function D(e){return e.className.trim().split(/\s+/)}function M(e,t){return C(e,"."+t)}function N(e,t){var n=D(e);n.indexOf(t)<0&&n.push(t),e.className=n.join(" ")}function B(e,t){var n=D(e);i(n,t),e.className=n.join(" ")}function R(e,t,n){(n=ae(n)?!M(e,t):n)?N(e,t):B(e,t)}function F(e,t){if(ae(t)){var n=getComputedStyle(e),o=l(n.paddingLeft)+l(n.paddingRight),i=l(n.borderLeftWidth)+l(n.borderRightWidth);return e.offsetWidth-o-i}w(e,"width",t)}function H(e,t){if(ae(t)){var n=getComputedStyle(e),o=l(n.paddingTop)+l(n.paddingButtom),i=l(n.borderTopWidth)+l(n.borderBottomWidth);return e.offsetHeight-o-i}w(e,"height",t)}function z(e,t,n){var o;se(window.CustomEvent)?o=new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:n}):(o=e.ownerDocument.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,n),e.dispatchEvent(o)}function I(e){return!!e.getClientRects().length}function O(e){return e.replace(/^-ms-/,"ms-").replace(/-(\w)/g,function(e,t){return t.toUpperCase()})}function _(e,t,n,o,i){for(e=i?e.lastChild:e.firstChild;e;){var r=i?e.previousSibling:e.nextSibling;if(!n&&!1===t(e)||!o&&!1===_(e,t,n,o,i)||n&&!1===t(e))return!1;e=r}}function A(e,t,n,o){_(e,t,n,o,!0)}function L(e,t){var n=(t=t||document).createDocumentFragment(),o=a("div",{},t);for(o.innerHTML=e;o.firstChild;)f(n,o.firstChild);return n}function W(e){return e&&(!C(e,"p,div")||e.className||g(e,"style")||!n(k(e)))}function j(e,t){var n=a(t,{},e.ownerDocument);for(r(e.attributes,function(e,t){try{g(n,t.name,t.value)}catch(e){}});e.firstChild;)f(n,e.firstChild);return e.parentNode.replaceChild(n,e),n}function P(e){return!!/11?|9/.test(e.nodeType)&&"|iframe|area|base|basefont|br|col|frame|hr|img|input|wbr|isindex|link|meta|param|command|embed|keygen|source|track|object|".indexOf("|"+e.nodeName.toLowerCase()+"|")<0}function q(e,t){var n,o=(e||{}).nodeType||ve;return o!==ge?o===ve:(n=e.tagName.toLowerCase(),"code"===n?!t:ye.indexOf("|"+n+"|")<0)}function V(e,t){t.style.cssText=e.style.cssText+t.style.cssText}function $(e){var t=function(e){for(;q(e.parentNode,!0);)e=e.parentNode;return e};_(e,function(e){var n=!q(e,!0);if(n&&q(e.parentNode,!0)){var o=t(e),i=Y(o,e),r=e;V(o,r),T(i,o),T(r,o)}if(n&&C(e,"ul,ol")&&C(e.parentNode,"ul,ol")){var l=S(e,"li");l||T(l=a("li"),e),f(l,e)}})}function U(e,t){return e?(t?e.previousSibling:e.nextSibling)||U(e.parentNode,t):null}function Q(e,t){for(var n,o,i,r,l,a,s,c,u=e.firstChild;u;){if(s=u.nextSibling,n=u.nodeValue,(o=u.nodeType)===ge&&u.firstChild&&(a=w(u,"whiteSpace"),/pre(\-wrap)?$/i.test(a)||Q(u,/line$/i.test(a))),o===ve){for(i=U(u),r=U(u,!0),c=!1;M(r,"sceditor-ignore");)r=U(r,!0);if(q(u)&&r){for(l=r;l.lastChild;)l=l.lastChild;c=l.nodeType===ve?/[\t\n\r ]$/.test(l.nodeValue):!q(l)}n=n.replace(/\u200B/g,""),r&&q(r)&&!c||(n=n.replace(t?/^[\t ]+/:/^[\t\n\r ]+/,"")),i&&q(i)||(n=n.replace(t?/[\t ]+$/:/[\t\n\r ]+$/,"")),n.length?u.nodeValue=n.replace(t?/[\t ]+/g:/[\t\n\r ]+/g," "):d(u)}u=s}}function Y(e,t){var n=e.ownerDocument.createRange();return n.setStartBefore(e),n.setEndAfter(t),n.extractContents()}function K(e){for(var t=0,n=0;e;)t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;return{left:t,top:n}}function X(e,t){var n,o,i=e.style;if(me[t]||(me[t]=O(t)),t=me[t],o=i[t],"textAlign"===t){if(n=i.direction,o=o||w(e,t),w(e.parentNode,t)===o||"block"!==w(e,"display")||C(e,"hr,th"))return"";if(/right/i.test(o)&&"rtl"===n||/left/i.test(o)&&"ltr"===n)return""}return o}function G(e){return e.replace(/([\-.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function J(e,t){if(!e)return e;var n={"&":"&amp;","<":"&lt;",">":"&gt;","  ":"&nbsp; ","\r\n":"<br />","\r":"<br />","\n":"<br />"};return!1!==t&&(n['"']="&#34;",n["'"]="&#39;",n["`"]="&#96;"),e=e.replace(/ {2}|\r\n|[&<>\r\n'"`]/g,function(e){return n[e]||e})}function Z(e){if("mozHidden"in document)for(var t,n=e.getBody();n;){if((t=n).firstChild)t=t.firstChild;else{for(;t&&!t.nextSibling;)t=t.parentNode;t&&(t=t.nextSibling)}3===n.nodeType&&/[\n\r\t]+/.test(n.nodeValue)&&(/^pre/.test(w(n.parentNode,"whiteSpace"))||d(n)),n=t}}function ee(e){var t=this,n=[],o=function(e){return"signal"+e.charAt(0).toUpperCase()+e.slice(1)},i=function(t,i){t=[].slice.call(t);var r,l,a=o(t.shift());for(r=0;r<n.length;r++)if(a in n[r]&&(l=n[r][a].apply(e,t),i))return l};t.call=function(){i(arguments,!1)},t.callOnlyFirst=function(){return i(arguments,!0)},t.hasHandler=function(e){var t=n.length;for(e=o(e);t--;)if(e in n[t])return!0;return!1},t.exists=function(e){return e in Te&&"function"==typeof(e=Te[e])&&"object"==typeof e.prototype},t.isRegistered=function(e){if(t.exists(e))for(var o=n.length;o--;)if(n[o]instanceof Te[e])return!0;return!1},t.register=function(o){return!(!t.exists(o)||t.isRegistered(o)||(o=new Te[o],n.push(o),"init"in o&&o.init.call(e),0))},t.deregister=function(o){var i,r=n.length,l=!1;if(!t.isRegistered(o))return l;for(;r--;)n[r]instanceof Te[o]&&(l=!0,"destroy"in(i=n.splice(r,1)[0])&&i.destroy.call(e));return l},t.destroy=function(){for(var t=n.length;t--;)"destroy"in n[t]&&n[t].destroy.call(e);n=[],e=null}}function te(e,t){var n,o,i=t||e.contentDocument||e.document,r="sceditor-start-marker",l="sceditor-end-marker",s=this;s.insertHTML=function(e,t){var n,o;if(!s.selectedRange())return!1;for(t&&(e+=s.selectedHtml()+t),o=a("p",{},i),n=i.createDocumentFragment(),o.innerHTML=e;o.firstChild;)f(n,o.firstChild);s.insertNode(n)},o=function(e,t,o){var c,u=i.createDocumentFragment();if("string"==typeof e?(t&&(e+=s.selectedHtml()+t),u=L(e)):(f(u,e),t&&(f(u,s.selectedRange().extractContents()),f(u,t))),c=u.lastChild){for(;!q(c.lastChild,!0);)c=c.lastChild;if(P(c)?c.lastChild||f(c,document.createTextNode("​")):c=u,s.removeMarkers(),f(c,n(r)),f(c,n(l)),o){var d=a("div");return f(d,u),d.innerHTML}return u}},s.insertNode=function(e,t){var n=o(e,t),i=s.selectedRange(),r=i.commonAncestorContainer;if(!n)return!1;i.deleteContents(),r&&3!==r.nodeType&&!P(r)?T(n,r):i.insertNode(n),s.restoreRange()},s.cloneSelected=function(){var e=s.selectedRange();if(e)return e.cloneRange()},s.selectedRange=function(){var t,n,o=e.getSelection();if(o){if(o.getRangeAt&&o.rangeCount<=0){for(n=i.body;n.firstChild;)n=n.firstChild;(t=i.createRange()).setStartBefore(n),o.addRange(t)}return o.rangeCount>0&&(t=o.getRangeAt(0)),t}},s.hasSelection=function(){var t=e.getSelection();return t&&t.rangeCount>0},s.selectedHtml=function(){var e,t=s.selectedRange();return t?(e=a("p",{},i),f(e,t.cloneContents()),e.innerHTML):""},s.parentNode=function(){var e=s.selectedRange();if(e)return e.commonAncestorContainer},s.getFirstBlockParent=function(e){var t=function(e){return q(e,!0)?(e=e?e.parentNode:null,e?t(e):e):e};return t(e||s.parentNode())},s.insertNodeAt=function(e,t){var n=s.selectedRange(),o=s.cloneSelected();if(!o)return!1;o.collapse(e),o.insertNode(t),s.selectRange(n)},n=function(e){s.removeMarker(e);var t=a("span",{id:e,className:"sceditor-selection sceditor-ignore",style:"display:none;line-height:0"},i);return t.innerHTML=" ",t},s.insertMarkers=function(){var e=s.selectedRange(),t=n(r);s.removeMarkers(),s.insertNodeAt(!0,t),e&&e.collapsed?t.parentNode.insertBefore(n(l),t.nextSibling):s.insertNodeAt(!1,n(l))},s.getMarker=function(e){return i.getElementById(e)},s.removeMarker=function(e){var t=s.getMarker(e);t&&d(t)},s.removeMarkers=function(){s.removeMarker(r),s.removeMarker(l)},s.saveRange=function(){s.insertMarkers()},s.selectRange=function(t){var n,o=e.getSelection(),r=t.endContainer;if(!De&&t.collapsed&&r&&!q(r,!0)){for(n=r.lastChild;n&&C(n,".sceditor-ignore");)n=n.previousSibling;if(C(n,"br")){var l=i.createRange();l.setEndAfter(n),l.collapse(!1),s.compare(t,l)&&(t.setStartBefore(n),t.collapse(!0))}}o&&(s.clear(),o.addRange(t))},s.restoreRange=function(){var e,t=s.selectedRange(),n=s.getMarker(r),o=s.getMarker(l);if(!n||!o||!t)return!1;e=n.nextSibling===o,(t=i.createRange()).setStartBefore(n),t.setEndAfter(o),e&&t.collapse(!0),s.selectRange(t),s.removeMarkers()},s.selectOuterText=function(e,t){var n,o,i=s.cloneSelected();if(!i)return!1;i.collapse(!1),n=Me(i,!0,e),o=Me(i,!1,t),i.setStart(n.node,n.offset),i.setEnd(o.node,o.offset),s.selectRange(i)},s.getOuterText=function(e,t){var n=s.cloneSelected();return n?(n.collapse(!e),Me(n,e,t).text):""},s.replaceKeyword=function(e,t,n,o,i,r){n||e.sort(function(e,t){return e[0].length-t[0].length});var l,a,c,u,d,f,p,h,m=e.length,g=i?1:0,v=o||e[m-1][0].length;for(i&&v++,r=r||"",d=(l=s.getOuterText(!0,v)).length,l+=r,t&&(l+=s.getOuterText(!1,v));m--;)if(p=e[m][0],h=p.length,u=Math.max(0,d-h-g),c=-1,i?(a=l.substr(u).match(new RegExp("(^|[\\s    ])"+G(p)+"(^|[\\s    ])")))&&(c=a.index+u+a[1].length):c=l.indexOf(p,u),c>-1&&c<=d&&c+h+g>=d)return f=d-c,s.selectOuterText(f,h-f-(/^\S/.test(r)?1:0)),s.insertHTML(e[m][1]),!0;return!1},s.compare=function(e,t){return t||(t=s.selectedRange()),e&&t?0===e.compareBoundaryPoints(Range.END_TO_END,t)&&0===e.compareBoundaryPoints(Range.START_TO_START,t):!e&&!t},s.clear=function(){var t=e.getSelection();t&&(t.removeAllRanges?t.removeAllRanges():t.empty&&t.empty())}}function ne(e,t){var n=/[^\s\xA0\u2002\u2003\u2009\u00a0]+/,o=e&&p(e,"img[data-sceditor-emoticon]");if(e&&o.length)for(var i=0;i<o.length;i++){var r=o[i],l=r.parentNode,a=r.previousSibling,s=r.nextSibling;if(a&&n.test(a.nodeValue.slice(-1))||s&&n.test((s.nodeValue||"")[0])){var c=t.cloneSelected(),u=-1,f=c.startContainer,h=a.nodeValue;null===h&&(h=a.innerText||""),h+=k(r,"sceditor-emoticon"),f===s&&(u=h.length+c.startOffset),f===e&&e.childNodes[c.startOffset]===s&&(u=h.length),f===a&&(u=c.startOffset),s&&s.nodeType===ve||(s=l.insertBefore(l.ownerDocument.createTextNode(""),s)),s.insertData(0,h),d(a),d(r),u>-1&&(c.setStart(s,u),c.collapse(!0),t.selectRange(c))}}}function oe(e,t,n){var o=e.ownerDocument,i="(^|\\s| | | | |$)",l=[],a={};c(e,"code")||(r(t,function(e){a[e]=new RegExp(i+G(e)+i),l.push(e)}),l.sort(function(e,t){return t.length-e.length}),function e(i){for(i=i.firstChild;i;){if(i.nodeType!==ge||C(i,"code")||e(i),i.nodeType===ve)for(var r=0;r<l.length;r++){var s=i.nodeValue,c=l[r],u=n?s.search(a[c]):s.indexOf(c);if(u>-1){var d=s.indexOf(c,u),f=L(t[c],o),p=s.substr(d+c.length);f.appendChild(o.createTextNode(p)),i.nodeValue=s.substr(0,d),i.parentNode.insertBefore(f,i.nextSibling)}}i=i.nextSibling}}(e))}function ie(e,t){var n;_(e,function(e){q(e,!0)?(n||T(n=a("p",{},t),e),e.nodeType===ve&&""===e.nodeValue||f(n,e)):n=null},!1,!0)}function re(e,t){var n,l,s,c,v,E,S,D,O,_,L,V,U,Y,X,G,Z,ce,ue,de,me,ye,we,ke,Ee,Te,De,Me,ze,Ie,Oe,_e,Ae,Le,We,je,Pe,qe,Ve,$e,Ue,Qe,Ye,Ke,Xe,Ge,Je,Ze,et,tt,nt,ot,it,rt,lt,at,st,ct,ut,dt,ft=this,pt=e.get?e.get(0):e,ht={},mt=[],gt=[],vt={},bt={},yt={};ft.commands=o(!0,{},t.commands||Se),ft.opts=t=o(!0,{},xe,t),ke=function(){pt._sceditor=ft,t.locale&&"en"!==t.locale&&Ie(),T(n=a("div",{className:"sceditor-container"}),pt),w(n,"z-index",t.zIndex),Re&&N(n,"ie ie"+Re),ce=pt.required,pt.required=!1,ze(),We(),Oe(),Me(),_e(),Ae(),he||ft.toggleSourceMode(),Je();var e=function(){m(Ne,"load",e),t.autofocus&&ot(),dt(),et(),U.call("ready")};h(Ne,"load",e),"complete"===Be.readyState&&e()},ze=function(){var e=t.plugins;e=e?e.toString().split(","):[],U=new ee(ft),e.forEach(function(e){U.register(e.trim())})},Ie=function(){var e;(L=re.locale[t.locale])||(e=t.locale.split("-"),L=re.locale[e[0]]),L&&L.dateFormat&&(t.dateFormat=L.dateFormat)},Me=function(){E=a("textarea"),s=a("iframe",{frameborder:0,allowfullscreen:!0}),t.startInSourceMode?(N(n,"sourceMode"),b(s)):(N(n,"wysiwygMode"),b(E)),t.spellcheck||g(n,"spellcheck","false"),"https:"===Ne.location.protocol&&g(s,"src","javascript:false"),f(n,s),f(n,E),ft.dimensions(t.width||F(pt),t.height||H(pt)),(v=s.contentDocument).open(),v.write(Ce("html",{attrs:Re?' class="ie ie'+Re+'"':"",spellcheck:t.spellcheck?"":'spellcheck="false"',charset:t.charset,style:t.style})),v.close(),c=v.body,ft.readOnly(!!t.readOnly),(pe||fe||Re)&&(H(c,"100%"),Re||h(c,"touchend",ft.focus));var e=g(pt,"tabindex");g(E,"tabindex",e),g(s,"tabindex",e),V=new te(s.contentWindow),b(pt),ft.val(pt.value);var o=t.placeholder||g(pt,"placeholder");o&&(E.placeholder=o,g(c,"placeholder",o))},_e=function(){t.autoUpdate&&(h(c,"blur",ut),h(E,"blur",ut)),null===t.rtl&&(t.rtl="rtl"===w(E,"direction")),ft.rtl(!!t.rtl),t.autoExpand&&(h(c,"load",dt,be),h(v,"input keyup",dt)),t.resizeEnabled&&Le(),g(n,"id",t.id),ft.emoticons(t.emoticonsEnabled)},Ae=function(){var e=pt.form,o="onselectionchange"in v?"selectionchange":"keyup focus blur contextmenu mouseup touchend click";h(Be,"click",Xe),e&&(h(e,"reset",Ue),h(e,"submit",ft.updateOriginal,be)),h(c,"keypress",$e),h(c,"keydown",qe),h(c,"keydown",Ve),h(c,"keyup",et),h(c,"blur",st),h(c,"keyup",ct),h(c,"paste",je),h(c,"compositionstart compositionend",Ye),h(c,o,tt),h(c,"keydown keyup keypress focus blur contextmenu",Ke),t.emoticonsCompat&&Ne.getSelection&&h(c,"keyup",rt),h(c,"blur",function(){ft.val()||N(c,"placeholder")}),h(c,"focus",function(){B(c,"placeholder")}),h(E,"blur",st),h(E,"keyup",ct),h(E,"keydown",qe),h(E,"compositionstart compositionend",Ye),h(E,"keydown keyup keypress focus blur contextmenu",Ke),h(v,"mousedown",Qe),h(v,o,tt),h(v,"beforedeactivate keyup mouseup",De),h(v,"keyup",et),h(v,"focus",function(){D=null}),h(n,"selectionchanged",nt),h(n,"selectionchanged",Je),h(n,"selectionchanged valuechanged nodechanged",Ke)},Oe=function(){var e,o=ft.commands,i=(t.toolbarExclude||"").split(","),s=t.toolbar.split("|");l=a("div",{className:"sceditor-toolbar",unselectable:"on"}),r(s,function(t,n){e=a("div",{className:"sceditor-group"}),r(n.split(","),function(t,n){var r,l,a=o[n];!a||i.indexOf(n)>-1||(l=a.shortcut,(r=Ce("toolbarButton",{name:n,dispName:ft._(a.name||a.tooltip||n)},!0).firstChild)._sceTxtMode=!!a.txtExec,r._sceWysiwygMode=!!a.exec,R(r,"disabled",!a.exec),h(r,"click",function(e){M(r,"disabled")||Te(r,a),Je(),e.preventDefault()}),a.tooltip&&g(r,"title",ft._(a.tooltip)+(l?" ("+l+")":"")),l&&ft.addShortcut(l,n),a.state?gt.push({name:n,state:a.state}):le(a.exec)&&gt.push({name:n,state:a.exec}),f(e,r),bt[n]=r)}),e.firstChild&&f(l,e)}),f(t.toolbarContainer||n,l)},Le=function(){var e,o,i,r,l,s,c=a("div",{className:"sceditor-grip"}),u=a("div",{className:"sceditor-resize-cover"}),d="touchcancel touchend mouseup",p=0,g=0,v=0,x=0,w=0,k=0,C=F(n),E=H(n),S=!1,T=ft.rtl();e=t.resizeMinHeight||E/1.5,o=t.resizeMaxHeight||2.5*E,i=t.resizeMinWidth||C/1.25,r=t.resizeMaxWidth||1.25*C,l=function(n){"touchmove"===n.type?(n=Ne.event,v=n.changedTouches[0].pageX,x=n.changedTouches[0].pageY):(v=n.pageX,x=n.pageY);var l=k+(x-g),a=T?w-(v-p):w+(v-p);r>0&&a>r&&(a=r),i>0&&a<i&&(a=i),t.resizeWidth||(a=!1),o>0&&l>o&&(l=o),e>0&&l<e&&(l=e),t.resizeHeight||(l=!1),(a||l)&&ft.dimensions(a,l),n.preventDefault()},s=function(e){S&&(S=!1,b(u),B(n,"resizing"),m(Be,"touchmove mousemove",l),m(Be,d,s),e.preventDefault())},f(n,c),f(n,u),b(u),h(c,"touchstart mousedown",function(e){"touchstart"===e.type?(e=Ne.event,p=e.touches[0].pageX,g=e.touches[0].pageY):(p=e.pageX,g=e.pageY),w=F(n),k=H(n),S=!0,N(n,"resizing"),y(u),h(Be,"touchmove mousemove",l),h(Be,d,s),e.preventDefault()})},We=function(){var e=t.emoticons,n=t.emoticonsRoot||"";e&&(yt=o({},e.more,e.dropdown,e.hidden)),r(yt,function(e,o){yt[e]=Ce("emoticon",{key:e,url:n+(o.url||o),tooltip:o.tooltip||e}),t.emoticonsEnabled&&mt.push(a("img",{src:n+(o.url||o)}))})},ot=function(){var e,o,i=c.firstChild,r=!!t.autofocusEnd;if(I(n)){if(ft.sourceMode())return o=r?E.value.length:0,void E.setSelectionRange(o,o);if(Q(c),r)for((i=c.lastChild)||(i=a("p",{},v),f(c,i));i.lastChild;)i=i.lastChild,!Fe&&C(i,"br")&&i.previousSibling&&(i=i.previousSibling);e=v.createRange(),P(i)?e.selectNodeContents(i):(e.setStartBefore(i),r&&e.setStartAfter(i)),e.collapse(!r),V.selectRange(e),G=e,r&&(c.scrollTop=c.scrollHeight),ft.focus()}},ft.readOnly=function(e){return"boolean"!=typeof e?!E.readonly:(c.contentEditable=!e,E.readonly=!e,Ge(e),ft)},ft.rtl=function(e){var t=e?"rtl":"ltr";return"boolean"!=typeof e?"rtl"===g(E,"dir"):(g(c,"dir",t),g(E,"dir",t),B(n,"rtl"),B(n,"ltr"),N(n,t),ft)},Ge=function(e){var t=ft.inSourceMode()?"_sceTxtMode":"_sceWysiwygMode";r(bt,function(n,o){R(o,"disabled",e||!o[t])})},ft.width=function(e,t){return e||0===e?(ft.dimensions(e,null,t),ft):F(n)},ft.dimensions=function(e,o,i){return e=!(!e&&0!==e)&&e,o=!(!o&&0!==o)&&o,!1===e&&!1===o?{width:ft.width(),height:ft.height()}:(!1!==e&&(!1!==i&&(t.width=e),F(n,e)),!1!==o&&(!1!==i&&(t.height=o),H(n,o)),ft)},ft.updateStyleCache=function(){},ft.height=function(e,t){return e||0===e?(ft.dimensions(null,e,t),ft):H(n)},ft.maximize=function(e){return ae(e)?M(n,"sceditor-maximize"):((e=!!e)&&(ye=Ne.pageYOffset),R(Be.documentElement,"sceditor-maximize",e),R(Be.body,"sceditor-maximize",e),R(n,"sceditor-maximize",e),ft.width(e?"100%":t.width,!1),ft.height(e?"100%":t.height,!1),e||Ne.scrollTo(0,ye),dt(),ft)},dt=function(){t.autoExpand&&!me&&setTimeout(ft.expandToContent,200)},ft.expandToContent=function(e){if(!ft.maximize()){if(me=!1,!de){var n=t.resizeMinHeight||t.height||H(pt);de={min:n,max:t.resizeMaxHeight||2*n}}var o=Be.createRange();o.selectNodeContents(c);var i=o.getBoundingClientRect(),r=v.documentElement.clientHeight,l=i.bottom-i.top,a=ft.height()+(l-r);e||-1===de.max||(a=Math.min(a,de.max)),ft.height(Math.ceil(Math.max(a,de.min)))}},ft.destroy=function(){if(U){U.destroy(),V=null,D=null,U=null,S&&d(S),m(Be,"click",Xe);var e=pt.form;e&&(m(e,"reset",Ue),m(e,"submit",ft.updateOriginal)),d(E),d(l),d(n),delete pt._sceditor,y(pt),pt.required=ce}},ft.createDropDown=function(e,n,i,l){var s,c="sceditor-"+n;ft.closeDropDown(!0),S&&M(S,c)||(!1!==l&&r(p(i,":not(input):not(textarea)"),function(e,t){t.nodeType===ge&&g(t,"unselectable","on")}),s=o({top:K(e).top,left:K(e).left,marginTop:e.clientHeight},t.dropDownCss),w(S=a("div",{className:"sceditor-dropdown "+c}),s),f(S,i),f(Be.body,S),h(S,"click focusin",function(e){e.stopPropagation()}),setTimeout(function(){if(S){var e=p(S,"input,textarea")[0];e&&e.focus()}}))},Xe=function(e){3!==e.which&&S&&!e.defaultPrevented&&(ut(),ft.closeDropDown())},je=function(e){var t=Re||fe,n=c,o=e.clipboardData;if(o&&!t){var i={},r=o.types,l=o.items;e.preventDefault();for(var a=0;a<r.length;a++){if(Ne.FileReader&&l&&He.test(l[a].type))return function(e){var t=new FileReader;t.onload=function(e){Pe({html:'<img src="'+e.target.result+'" />'})},t.readAsDataURL(e)}(o.items[a].getAsFile());i[r[a]]=o.getData(r[a])}i.text=i["text/plain"],i.html=i["text/html"],Pe(i)}else if(!we){var s=n.scrollTop;for(V.saveRange(),we=Be.createDocumentFragment();n.firstChild;)f(we,n.firstChild);setTimeout(function(){var e=n.innerHTML;n.innerHTML="",f(n,we),n.scrollTop=s,we=!1,V.restoreRange(),Pe({html:e})},0)}},Pe=function(e){var t=a("div",{},v);U.call("pasteRaw",e),e.html?(t.innerHTML=e.html,$(t)):t.innerHTML=J(e.text||"");var n={val:t.innerHTML};U.hasHandler("toSource")&&(f(c,t),n.val=U.callOnlyFirst("toSource",n.val,t),d(t)),U.call("paste",n),U.hasHandler("toWysiwyg")&&(n.val=U.callOnlyFirst("toWysiwyg",n.val,!0)),U.call("pasteHtml",n),ft.wysiwygEditorInsertHtml(n.val,null,!0)},ft.closeDropDown=function(e){S&&(d(S),S=null),!0===e&&ft.focus()},ft.wysiwygEditorInsertHtml=function(e,t,n){var o,i,r,l=H(s);ft.focus(),!n&&u(X,"code")||(V.insertHTML(e,t),V.saveRange(),Ee(),y(o=p(c,"#sceditor-end-marker")[0]),i=c.scrollTop,r=K(o).top+1.5*o.offsetHeight-l,b(o),(r>i||r+l<i)&&(c.scrollTop=r),at(!1),V.restoreRange(),et())},ft.wysiwygEditorInsertText=function(e,t){ft.wysiwygEditorInsertHtml(J(e),J(t))},ft.insertText=function(e,t){return ft.inSourceMode()?ft.sourceEditorInsertText(e,t):ft.wysiwygEditorInsertText(e,t),ft},ft.sourceEditorInsertText=function(e,t){var n,o,i=E.selectionStart,r=E.selectionEnd;n=E.scrollTop,E.focus(),o=E.value,t&&(e+=o.substring(i,r)+t),E.value=o.substring(0,i)+e+o.substring(r,o.length),E.selectionStart=i+e.length-(t?t.length:0),E.selectionEnd=E.selectionStart,E.scrollTop=n,E.focus(),at()},ft.getRangeHelper=function(){return V},ft.sourceEditorCaret=function(e){return E.focus(),e?(E.selectionStart=e.start,E.selectionEnd=e.end,this):{start:E.selectionStart,end:E.selectionEnd}},ft.val=function(e,t){return le(e)?(ft.inSourceMode()?ft.setSourceEditorValue(e):(!1!==t&&U.hasHandler("toWysiwyg")&&(e=U.callOnlyFirst("toWysiwyg",e)),ft.setWysiwygEditorValue(e)),ft):ft.inSourceMode()?ft.getSourceEditorValue(!1):ft.getWysiwygEditorValue(t)},ft.insert=function(e,t,n,o,i){if(ft.inSourceMode())return ft.sourceEditorInsertText(e,t),ft;if(t){var r=V.selectedHtml(),l=a("div");f(c,l),b(l),l.innerHTML=r,!1!==n&&U.hasHandler("toSource")&&(r=U.callOnlyFirst("toSource",r,l)),d(l),e+=r+t}return!1!==n&&U.hasHandler("toWysiwyg")&&(e=U.callOnlyFirst("toWysiwyg",e,!0)),!1!==n&&!0===i&&(e=e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")),ft.wysiwygEditorInsertHtml(e),ft},ft.getWysiwygEditorValue=function(e){for(var t,n=a("div",{},v),o=c.childNodes,i=0;i<o.length;i++)f(n,o[i].cloneNode(!0));return f(c,n),$(n),t=n.innerHTML,!1!==e&&U.hasHandler("toSource")&&(t=U.callOnlyFirst("toSource",t,n)),d(n),t},ft.getBody=function(){return c},ft.getContentAreaContainer=function(){return s},ft.getSourceEditorValue=function(e){var t=E.value;return!1!==e&&U.hasHandler("toWysiwyg")&&(t=U.callOnlyFirst("toWysiwyg",t)),t},ft.setWysiwygEditorValue=function(e){e||(e="<p>"+(Re?"":"<br />")+"</p>"),c.innerHTML=e,Ee(),et(),at(),dt()},ft.setSourceEditorValue=function(e){E.value=e,at()},ft.updateOriginal=function(){pt.value=ft.val()},Ee=function(){t.emoticonsEnabled&&oe(c,yt,t.emoticonsCompat)},ft.inSourceMode=function(){return M(n,"sourceMode")},ft.sourceMode=function(e){var t=ft.inSourceMode();return"boolean"!=typeof e?t:((t&&!e||!t&&e)&&ft.toggleSourceMode(),ft)},ft.toggleSourceMode=function(){var e=ft.inSourceMode();!he&&e||(e||(V.saveRange(),V.clear()),ft.blur(),e?ft.setWysiwygEditorValue(ft.getSourceEditorValue()):ft.setSourceEditorValue(ft.getWysiwygEditorValue()),D=null,x(E),!e&&Re<10&&E.focus(),x(s),!e&&Re<10&&E.blur(),R(n,"wysiwygMode",e),R(n,"sourceMode",!e),Ge(),Je())},Ze=function(){return E.focus(),E.value.substring(E.selectionStart,E.selectionEnd)},Te=function(e,t){ft.inSourceMode()?t.txtExec&&(Array.isArray(t.txtExec)?ft.sourceEditorInsertText.apply(ft,t.txtExec):t.txtExec.call(ft,e,Ze())):t.exec&&(se(t.exec)?t.exec.call(ft,e):ft.execCommand(t.exec,t.hasOwnProperty("execParam")?t.execParam:null))},De=function(){Re&&(D=V.selectedRange())},ft.execCommand=function(e,t){var n=!1,o=ft.commands[e];if(ft.focus(),!u(V.parentNode(),"code")){try{n=v.execCommand(e,!1,t)}catch(e){}!n&&o&&o.errorMessage&&alert(ft._(o.errorMessage)),Je()}},tt=function(){function e(){if(V&&!V.compare(G)){if((G=V.cloneSelected())&&G.collapsed){var e=G.startContainer,t=G.startOffset;for(t&&e.nodeType!==ve&&(e=e.childNodes[t]);e&&e.parentNode!==c;)e=e.parentNode;e&&q(e,!0)&&(V.saveRange(),ie(c,v),V.restoreRange())}z(n,"selectionchanged")}Z=!1}Z||(Z=!0,"onselectionchange"in v?e():setTimeout(e,100))},nt=function(){var e,t=V.parentNode();Y!==t&&(e=Y,Y=t,X=V.getFirstBlockParent(t),z(n,"nodechanged",{oldNode:e,newNode:Y}))},ft.currentNode=function(){return Y},ft.currentBlockNode=function(){return X},Je=function(){var e,t,n=v,o=ft.sourceMode();if(ft.readOnly())r(p(l,"active"),function(e,t){B(t,"active")});else{o||(t=V.parentNode(),e=V.getFirstBlockParent(t));for(var i=0;i<gt.length;i++){var a=0,s=bt[gt[i].name],c=gt[i].state,u=o&&!s._sceTxtMode||!o&&!s._sceWysiwygMode;if(le(c)){if(!o)try{(a=n.queryCommandEnabled(c)?0:-1)>-1&&(a=n.queryCommandState(c)?1:0)}catch(e){}}else u||(a=c.call(ft,t,e));R(s,"disabled",u||a<0),R(s,"active",a>0)}}},$e=function(e){if(!e.defaultPrevented&&(ft.closeDropDown(),13===e.which)&&!C(X,"li,ul,ol")&&W(X)){D=null;var t=a("br",{},v);if(V.insertNode(t),!Fe){var n=t.parentNode,o=n.lastChild;o&&o.nodeType===ve&&""===o.nodeValue&&(d(o),o=n.lastChild),!q(n,!0)&&o===t&&q(t.previousSibling)&&V.insertHTML("<br>")}e.preventDefault()}},et=function(){A(c,function(e){if(e.nodeType===ge&&!/inline/.test(w(e,"display"))&&!C(e,".sceditor-nlf")&&W(e)){var t=a("p",{},v);return t.className="sceditor-nlf",t.innerHTML=Fe?"":"<br />",f(c,t),!1}if(3===e.nodeType&&!/^\s*$/.test(e.nodeValue)||C(e,"br"))return!1})},Ue=function(){ft.val(pt.value)},Qe=function(){ft.closeDropDown(),D=null},ft._=function(){var e=arguments;return L&&L[e[0]]&&(e[0]=L[e[0]]),e[0].replace(/\{(\d+)\}/g,function(t,n){return void 0!==e[n-0+1]?e[n-0+1]:"{"+n+"}"})},Ke=function(e){U.call(e.type+"Event",e,ft);var t=(e.target===E?"scesrc":"scewys")+e.type;ht[t]&&ht[t].forEach(function(t){t.call(ft,e)})},ft.bind=function(e,t,n,o){for(var i=(e=e.split(" ")).length;i--;)if(se(t)){var r="scewys"+e[i],l="scesrc"+e[i];n||(ht[r]=ht[r]||[],ht[r].push(t)),o||(ht[l]=ht[l]||[],ht[l].push(t)),"valuechanged"===e[i]&&(at.hasHandler=!0)}return ft},ft.unbind=function(e,t,n,o){for(var r=(e=e.split(" ")).length;r--;)se(t)&&(n||i(ht["scewys"+e[r]]||[],t),o||i(ht["scesrc"+e[r]]||[],t));return ft},ft.blur=function(e,t,n){return se(e)?ft.bind("blur",e,t,n):ft.sourceMode()?E.blur():c.blur(),ft},ft.focus=function(e,t,n){if(se(e))ft.bind("focus",e,t,n);else if(ft.inSourceMode())E.focus();else{if(p(v,":focus").length)return;var o,i=V.selectedRange();G||ot(),!Fe&&i&&1===i.endOffset&&i.collapsed&&(o=i.endContainer)&&1===o.childNodes.length&&C(o.firstChild,"br")&&(i.setStartBefore(o.firstChild),i.collapse(!0),V.selectRange(i)),s.contentWindow.focus(),c.focus(),D&&(V.selectRange(D),D=null)}return Je(),ft},ft.keyDown=function(e,t,n){return ft.bind("keydown",e,t,n)},ft.keyPress=function(e,t,n){return ft.bind("keypress",e,t,n)},ft.keyUp=function(e,t,n){return ft.bind("keyup",e,t,n)},ft.nodeChanged=function(e){return ft.bind("nodechanged",e,!1,!0)},ft.selectionChanged=function(e){return ft.bind("selectionchanged",e,!1,!0)},ft.valueChanged=function(e,t,n){return ft.bind("valuechanged",e,t,n)},it=function(e){var n=0,o=ft.emoticonsCache,i=String.fromCharCode(e.which);u(X,"code")||(o||(o=[],r(yt,function(e,t){o[n++]=[e,t]}),o.sort(function(e,t){return e[0].length-t[0].length}),ft.emoticonsCache=o,ft.longestEmoticonCode=o[o.length-1][0].length),V.replaceKeyword(ft.emoticonsCache,!0,!0,ft.longestEmoticonCode,t.emoticonsCompat,i)&&(t.emoticonsCompat&&/^\s$/.test(i)||e.preventDefault()))},rt=function(){ne(X,V)},ft.emoticons=function(e){return e||!1===e?(t.emoticonsEnabled=e,e?(h(c,"keypress",it),ft.sourceMode()||(V.saveRange(),Ee(),at(!1),V.restoreRange())):(r(p(c,"img[data-sceditor-emoticon]"),function(e,t){var n=k(t,"sceditor-emoticon"),o=v.createTextNode(n);t.parentNode.replaceChild(o,t)}),m(c,"keypress",it),at()),ft):t.emoticonsEnabled},ft.css=function(e){return ue||(ue=a("style",{id:"inline"},v),f(v.head,ue)),le(e)?(ue.styleSheet?ue.styleSheet.cssText=e:ue.innerHTML=e,ft):ue.styleSheet?ue.styleSheet.cssText:ue.innerHTML},qe=function(e){var t=[],n={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|","[":"{","]":"}"},o={8:"backspace",9:"tab",13:"enter",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",91:"win",92:"win",93:"select",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},i={109:"-",110:"del",111:"/",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9"},r=e.which,l=o[r]||String.fromCharCode(r).toLowerCase();(e.ctrlKey||e.metaKey)&&t.push("ctrl"),e.altKey&&t.push("alt"),e.shiftKey&&(t.push("shift"),i[r]?l=i[r]:n[l]&&(l=n[l])),l&&(r<16||r>18)&&t.push(l),t=t.join("+"),vt[t]&&!1===vt[t].call(ft)&&(e.stopPropagation(),e.preventDefault())},ft.addShortcut=function(e,t){return e=e.toLowerCase(),le(t)?vt[e]=function(){return Te(bt[t],ft.commands[t]),!1}:vt[e]=t,ft},ft.removeShortcut=function(e){return delete vt[e.toLowerCase()],ft},Ve=function(e){var n,o,i;if(!t.disableBlockRemove&&8===e.which&&(o=V.selectedRange())&&(n=o.startContainer,0===o.startOffset&&(i=lt()))){for(;n!==i;){for(;n.previousSibling;)if((n=n.previousSibling).nodeType!==ve||n.nodeValue)return;if(!(n=n.parentNode))return}i&&!C(i,"body")&&(ft.clearBlockFormatting(i),e.preventDefault())}},lt=function(){for(var e=X;!W(e)||q(e,!0);)if(!(e=e.parentNode)||C(e,"body"))return;return e},ft.clearBlockFormatting=function(e){return!(e=e||lt())||C(e,"body")?ft:(V.saveRange(),e.className="",D=null,g(e,"style",""),C(e,"p,div,td")||j(e,"p"),V.restoreRange(),ft)},at=function(e){if(U&&(U.hasHandler("valuechangedEvent")||at.hasHandler)){var t,o=ft.sourceMode(),i=!o&&V.hasSelection();O=!1,e=!1!==e&&!v.getElementById("sceditor-start-marker"),_&&(clearTimeout(_),_=!1),i&&e&&V.saveRange(),(t=o?E.value:c.innerHTML)!==at.lastVal&&(at.lastVal=t,z(n,"valuechanged",{rawValue:o?ft.val():t})),i&&e&&V.removeMarkers()}},st=function(){_&&at()},ct=function(e){var t=e.which,n=ct.lastChar,o=13===n||32===n,i=8===n||46===n;ct.lastChar=t,O||(13===t||32===t?o?ct.triggerNext=!0:at():8===t||46===t?i?ct.triggerNext=!0:at():ct.triggerNext&&(at(),ct.triggerNext=!1),clearTimeout(_),_=setTimeout(function(){O||at()},1500))},Ye=function(e){(O=/start/i.test(e.type))||at()},ut=function(){ft.updateOriginal()},ke()}e=e&&"default"in e?e.default:e;var le=t.bind(null,"string"),ae=t.bind(null,"undefined"),se=t.bind(null,"function"),ce=t.bind(null,"number"),ue=navigator.userAgent,de=function(){var e=3,t=document,n=t.createElement("div"),o=n.getElementsByTagName("i");do{n.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i></i><![endif]--\x3e"}while(o[0]);return t.documentMode&&t.all&&window.atob&&(e=10),4===e&&t.documentMode&&(e=11),e>4?e:void 0}(),fe="-ms-ime-align"in document.documentElement.style,pe=/iPhone|iPod|iPad| wosbrowser\//i.test(ue),he=function(){var e,t,n=document.createElement("div");return n.contentEditable=!0,"contentEditable"in document.documentElement&&"true"===n.contentEditable&&(t=/Opera Mobi|Opera Mini/i.test(ue),/Android/i.test(ue)&&(t=!0,/Safari/.test(ue)&&(t=!(e=/Safari\/(\d+)/.exec(ue))||!e[1]||e[1]<534)),/ Silk\//i.test(ue)&&(t=!(e=/AppleWebKit\/(\d+)/.exec(ue))||!e[1]||e[1]<534),pe&&(t=/OS [0-4](_\d)+ like Mac/i.test(ue)),/Firefox/i.test(ue)&&(t=!1),/OneBrowser/i.test(ue)&&(t=!1),"UCWEB"===navigator.vendor&&(t=!1),de<9&&(t=!0),!t)}(),me={},ge=1,ve=3,be=!0,ye="|body|hr|p|div|h1|h2|h3|h4|h5|h6|address|pre|form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|blockquote|center|",xe={toolbar:"bold,italic,underline,strike,subscript,superscript|left,center,right,justify|font,size,color,removeformat|cut,copy,paste,pastetext|bulletlist,orderedlist,indent,outdent|table|code,quote|horizontalrule,image,email,link,unlink|emoticon,youtube,date,time|ltr,rtl|print,maximize,source",toolbarExclude:null,style:"jquery.sceditor.default.css",fonts:"Arial,Arial Black,Comic Sans MS,Courier New,Georgia,Impact,Sans-serif,Serif,Times New Roman,Trebuchet MS,Verdana",colors:"#000,#44B8FF,#1E92F7,#0074D9,#005DC2,#00369B,#b3d5f4|#444,#C3FFFF,#9DF9FF,#7FDBFF,#68C4E8,#419DC1,#d9f4ff|#666,#72FF84,#4CEA5E,#2ECC40,#17B529,#008E02,#c0f0c6|#888,#FFFF44,#FFFA1E,#FFDC00,#E8C500,#C19E00,#fff5b3|#aaa,#FFC95F,#FFA339,#FF851B,#E86E04,#C14700,#ffdbbb|#ccc,#FF857A,#FF5F54,#FF4136,#E82A1F,#C10300,#ffc6c3|#eee,#FF56FF,#FF30DC,#F012BE,#D900A7,#B20080,#fbb8ec|#fff,#F551FF,#CF2BE7,#B10DC9,#9A00B2,#9A00B2,#e8b6ef",locale:g(document.documentElement,"lang")||"en",charset:"utf-8",emoticonsCompat:!1,emoticonsEnabled:!0,emoticonsRoot:"",emoticons:{dropdown:{":)":"emoticons/smile.png",":angel:":"emoticons/angel.png",":angry:":"emoticons/angry.png","8-)":"emoticons/cool.png",":'(":"emoticons/cwy.png",":ermm:":"emoticons/ermm.png",":D":"emoticons/grin.png","<3":"emoticons/heart.png",":(":"emoticons/sad.png",":O":"emoticons/shocked.png",":P":"emoticons/tongue.png",";)":"emoticons/wink.png"},more:{":alien:":"emoticons/alien.png",":blink:":"emoticons/blink.png",":blush:":"emoticons/blush.png",":cheerful:":"emoticons/cheerful.png",":devil:":"emoticons/devil.png",":dizzy:":"emoticons/dizzy.png",":getlost:":"emoticons/getlost.png",":happy:":"emoticons/happy.png",":kissing:":"emoticons/kissing.png",":ninja:":"emoticons/ninja.png",":pinch:":"emoticons/pinch.png",":pouty:":"emoticons/pouty.png",":sick:":"emoticons/sick.png",":sideways:":"emoticons/sideways.png",":silly:":"emoticons/silly.png",":sleeping:":"emoticons/sleeping.png",":unsure:":"emoticons/unsure.png",":woot:":"emoticons/w00t.png",":wassat:":"emoticons/wassat.png"},hidden:{":whistling:":"emoticons/whistling.png",":love:":"emoticons/wub.png"}},width:null,height:null,resizeEnabled:!0,resizeMinWidth:null,resizeMinHeight:null,resizeMaxHeight:null,resizeMaxWidth:null,resizeHeight:!0,resizeWidth:!0,dateFormat:"year-month-day",toolbarContainer:null,enablePasteFiltering:!1,disablePasting:!1,readOnly:!1,rtl:!1,autofocus:!1,autofocusEnd:!0,autoExpand:!1,autoUpdate:!1,spellcheck:!0,runWithoutWysiwygSupport:!1,startInSourceMode:!1,id:null,plugins:"",zIndex:null,bbcodeTrim:!1,disableBlockRemove:!1,parserOptions:{},dropDownCss:{}},we=/^(https?|s?ftp|mailto|spotify|skype|ssh|teamspeak|tel):|(\/\/)|data:image\/(png|bmp|gif|p?jpe?g);/i,ke={html:'<!DOCTYPE html><html{attrs}><head><style>.ie * {min-height: auto !important} .ie table td {height:15px} @supports (-ms-ime-align:auto) { * { min-height: auto !important; } }</style><meta http-equiv="Content-Type" content="text/html;charset={charset}" /><link rel="stylesheet" type="text/css" href="{style}" /></head><body contenteditable="true" {spellcheck}><p></p></body></html>',toolbarButton:'<a class="sceditor-button sceditor-button-{name}" data-sceditor-command="{name}" unselectable="on"><div unselectable="on">{dispName}</div></a>',emoticon:'<img src="{url}" data-sceditor-emoticon="{key}" alt="{key}" title="{tooltip}" />',fontOpt:'<a class="sceditor-font-option" href="#" data-font="{font}"><font face="{font}">{font}</font></a>',sizeOpt:'<a class="sceditor-fontsize-option" data-size="{size}" href="#"><font size="{size}">{size}</font></a>',pastetext:'<div><label for="txt">{label}</label> <textarea cols="20" rows="7" id="txt"></textarea></div><div><input type="button" class="button" value="{insert}" /></div>',table:'<div><label for="rows">{rows}</label><input type="text" id="rows" value="2" /></div><div><label for="cols">{cols}</label><input type="text" id="cols" value="2" /></div><div><input type="button" class="button" value="{insert}" /></div>',image:'<div><label for="link">{url}</label> <input type="text" id="image" placeholder="https://" /></div><div><label for="width">{width}</label> <input type="text" id="width" size="2" /></div><div><label for="height">{height}</label> <input type="text" id="height" size="2" /></div><div><input type="button" class="button" value="{insert}" /></div>',email:'<div><label for="email">{label}</label> <input type="text" id="email" /></div><div><label for="des">{desc}</label> <input type="text" id="des" /></div><div><input type="button" class="button" value="{insert}" /></div>',link:'<div><label for="link">{url}</label> <input type="text" id="link" placeholder="https://" /></div><div><label for="des">{desc}</label> <input type="text" id="des" /></div><div><input type="button" class="button" value="{ins}" /></div>',youtubeMenu:'<div><label for="link">{label}</label> <input type="text" id="link" placeholder="https://" /></div><div><input type="button" class="button" value="{insert}" /></div>',youtube:'<iframe width="560" height="315" frameborder="0" allowfullscreensrc="https://www.youtube.com/embed/{id}?wmode=opaque&start={time}" data-youtube-id="{id}"></iframe>'},Ce=function(e,t,n){var o=ke[e];return Object.keys(t).forEach(function(e){o=o.replace(new RegExp(G("{"+e+"}"),"g"),t[e])}),n&&(o=L(o)),o},Ee=de&&de<11,Se={bold:{exec:"bold",tooltip:"Bold",shortcut:"Ctrl+B"},italic:{exec:"italic",tooltip:"Italic",shortcut:"Ctrl+I"},underline:{exec:"underline",tooltip:"Underline",shortcut:"Ctrl+U"},strike:{exec:"strikethrough",tooltip:"Strikethrough"},subscript:{exec:"subscript",tooltip:"Subscript"},superscript:{exec:"superscript",tooltip:"Superscript"},left:{exec:"justifyleft",tooltip:"Align left"},center:{exec:"justifycenter",tooltip:"Center"},right:{exec:"justifyright",tooltip:"Align right"},justify:{exec:"justifyfull",tooltip:"Justify"},font:{_dropDown:function(e,t,n){var o=a("div");h(o,"click","a",function(t){n(k(this,"font")),e.closeDropDown(!0),t.preventDefault()}),e.opts.fonts.split(",").forEach(function(e){f(o,Ce("fontOpt",{font:e},!0))}),e.createDropDown(t,"font-picker",o)},exec:function(e){var t=this;Se.font._dropDown(t,e,function(e){t.execCommand("fontname",e)})},tooltip:"Font Name"},size:{_dropDown:function(e,t,n){var o=a("div");h(o,"click","a",function(t){n(k(this,"size")),e.closeDropDown(!0),t.preventDefault()});for(var i=1;i<=7;i++)f(o,Ce("sizeOpt",{size:i},!0));e.createDropDown(t,"fontsize-picker",o)},exec:function(e){var t=this;Se.size._dropDown(t,e,function(e){t.execCommand("fontsize",e)})},tooltip:"Font Size"},color:{_dropDown:function(e,t,n){var o=a("div"),i="",r=Se.color;r._htmlCache||(e.opts.colors.split("|").forEach(function(e){i+='<div class="sceditor-color-column">',e.split(",").forEach(function(e){i+='<a href="#" class="sceditor-color-option" style="background-color: '+e+'" data-color="'+e+'"></a>'}),i+="</div>"}),r._htmlCache=i),f(o,L(r._htmlCache)),h(o,"click","a",function(t){n(k(this,"color")),e.closeDropDown(!0),t.preventDefault()}),e.createDropDown(t,"color-picker",o)},exec:function(e){var t=this;Se.color._dropDown(t,e,function(e){t.execCommand("forecolor",e)})},tooltip:"Font Color"},removeformat:{exec:"removeformat",tooltip:"Remove Formatting"},cut:{exec:"cut",tooltip:"Cut",errorMessage:"Your browser does not allow the cut command. Please use the keyboard shortcut Ctrl/Cmd-X"},copy:{exec:"copy",tooltip:"Copy",errorMessage:"Your browser does not allow the copy command. Please use the keyboard shortcut Ctrl/Cmd-C"},paste:{exec:"paste",tooltip:"Paste",errorMessage:"Your browser does not allow the paste command. Please use the keyboard shortcut Ctrl/Cmd-V"},pastetext:{exec:function(e){var t,n=a("div"),o=this;f(n,Ce("pastetext",{label:o._("Paste your text inside the following box:"),insert:o._("Insert")},!0)),h(n,"click",".button",function(e){(t=p(n,"#txt")[0].value)&&o.wysiwygEditorInsertText(t),o.closeDropDown(!0),e.preventDefault()}),o.createDropDown(e,"pastetext",n)},tooltip:"Paste Text"},bulletlist:{exec:function(){Z(this),this.execCommand("insertunorderedlist")},tooltip:"Bullet list"},orderedlist:{exec:function(){Z(this),this.execCommand("insertorderedlist")},tooltip:"Numbered list"},indent:{state:function(e,t){var n,o,i,r=s(t,"ul,ol,menu");return r.length>1&&r[0].children.length>1?0:C(t,"ul,ol,menu")&&(n=this.getRangeHelper().selectedRange(),o=n.startContainer.parentNode,i=n.endContainer.parentNode,o!==o.parentNode.firstElementChild||C(i,"li")&&i!==i.parentNode.lastElementChild)?0:-1},exec:function(){var e=this,t=e.getRangeHelper().getFirstBlockParent();e.focus(),s(t,"ul,ol,menu")&&e.execCommand("indent")},tooltip:"Add indent"},outdent:{state:function(e,t){return u(t,"ul,ol,menu")>0?0:-1},exec:function(){s(this.getRangeHelper().getFirstBlockParent(),"ul,ol,menu")&&this.execCommand("outdent")},tooltip:"Remove one indent"},table:{exec:function(e){var t=this,n=a("div");f(n,Ce("table",{rows:t._("Rows:"),cols:t._("Cols:"),insert:t._("Insert")},!0)),h(n,"click",".button",function(e){var o=Number(p(n,"#rows")[0].value),i=Number(p(n,"#cols")[0].value),r="<table>";o>0&&i>0&&(r+=Array(o+1).join("<tr>"+Array(i+1).join("<td>"+(Ee?"":"<br />")+"</td>")+"</tr>"),r+="</table>",t.wysiwygEditorInsertHtml(r),t.closeDropDown(!0),e.preventDefault())}),t.createDropDown(e,"inserttable",n)},tooltip:"Insert a table"},horizontalrule:{exec:"inserthorizontalrule",tooltip:"Insert a horizontal rule"},code:{exec:function(){this.wysiwygEditorInsertHtml("<code>",(Ee?"":"<br />")+"</code>")},tooltip:"Code"},image:{_dropDown:function(e,t,n,o){var i=a("div");f(i,Ce("image",{url:e._("URL:"),width:e._("Width (optional):"),height:e._("Height (optional):"),insert:e._("Insert")},!0));var r=p(i,"#image")[0];r.value=n,h(i,"click",".button",function(t){r.value&&o(r.value,p(i,"#width")[0].value,p(i,"#height")[0].value),e.closeDropDown(!0),t.preventDefault()}),e.createDropDown(t,"insertimage",i)},exec:function(e){var t=this;Se.image._dropDown(t,e,"",function(e,n,o){var i="";n&&(i+=' width="'+n+'"'),o&&(i+=' height="'+o+'"'),t.wysiwygEditorInsertHtml("<img"+i+' src="'+e+'" />')})},tooltip:"Insert an image"},email:{_dropDown:function(e,t,n){var o=a("div");f(o,Ce("email",{label:e._("E-mail:"),desc:e._("Description (optional):"),insert:e._("Insert")},!0)),h(o,"click",".button",function(t){var i=p(o,"#email")[0].value;i&&n(i,p(o,"#des")[0].value),e.closeDropDown(!0),t.preventDefault()}),e.createDropDown(t,"insertemail",o)},exec:function(e){var t=this;Se.email._dropDown(t,e,function(e,n){t.focus(),!t.getRangeHelper().selectedHtml()||n?t.wysiwygEditorInsertHtml('<a href="mailto:'+e+'">'+(n||e)+"</a>"):t.execCommand("createlink","mailto:"+e)})},tooltip:"Insert an email"},link:{_dropDown:function(e,t,n){function o(t){r.value&&n(r.value,p(i,"#des")[0].value),e.closeDropDown(!0),t.preventDefault()}var i=a("div");f(i,Ce("link",{url:e._("URL:"),desc:e._("Description (optional):"),ins:e._("Insert")},!0));var r=p(i,"#link")[0];h(i,"click",".button",o),h(i,"keypress",function(e){13===e.which&&r.value&&o(e)},be),e.createDropDown(t,"insertlink",i)},exec:function(e){var t=this;Se.link._dropDown(t,e,function(e,n){t.focus(),!t.getRangeHelper().selectedHtml()||n?(n=n||e,t.wysiwygEditorInsertHtml('<a href="'+e+'">'+n+"</a>")):t.execCommand("createlink",e)})},tooltip:"Insert a link"},unlink:{state:function(){return u(this.currentNode(),"a")?0:-1},exec:function(){var e=u(this.currentNode(),"a");if(e){for(;e.firstChild;)T(e.firstChild,e);d(e)}},tooltip:"Unlink"},quote:{exec:function(e,t,n){var o="<blockquote>",i="</blockquote>";t?(o=o+(n=n?"<cite>"+n+"</cite>":"")+t+i,i=null):""===this.getRangeHelper().selectedHtml()&&(i=(Ee?"":"<br />")+i),this.wysiwygEditorInsertHtml(o,i)},tooltip:"Insert a Quote"},emoticon:{exec:function(e){var t=this,n=function(i){var l,s=t.opts.emoticonsCompat,c=t.getRangeHelper(),u=s&&" "!==c.getOuterText(!0,1)?" ":"",d=s&&" "!==c.getOuterText(!1,1)?" ":"",p=a("div"),m=a("div"),v=0,b=o({},t.opts.emoticons.dropdown,i?t.opts.emoticons.more:{});return f(p,m),v=Math.sqrt(Object.keys(b).length),h(p,"click","img",function(e){t.insert(u+g(this,"alt")+d,null,!1).closeDropDown(!0),e.preventDefault()}),r(b,function(e,t){f(m,a("img",{src:t.url||t,alt:e,title:t.tooltip||e})),m.children.length>=v&&(m=a("div"),f(p,m))}),!i&&t.opts.emoticons.more&&(f(l=a("a",{className:"sceditor-more"}),document.createTextNode(t._("More"))),h(l,"click",function(o){t.createDropDown(e,"more-emoticons",n(!0)),o.preventDefault()}),f(p,l)),p};t.createDropDown(e,"emoticons",n(!1))},txtExec:function(e){Se.emoticon.exec.call(this,e)},tooltip:"Insert an emoticon"},youtube:{_dropDown:function(e,t,n){var o=a("div");f(o,Ce("youtubeMenu",{label:e._("Video URL:"),insert:e._("Insert")},!0)),h(o,"click",".button",function(t){var i=p(o,"#link")[0].value,l=i.match(/(?:v=|v\/|embed\/|youtu.be\/)(.{11})/),a=i.match(/[&|?](?:star)?t=((\d+[hms]?){1,3})/),s=0;a&&r(a[1].split(/[hms]/),function(e,t){""!==t&&(s=60*s+Number(t))}),l&&/^[a-zA-Z0-9_\-]{11}$/.test(l[1])&&n(l[1],s),e.closeDropDown(!0),t.preventDefault()}),e.createDropDown(t,"insertlink",o)},exec:function(e){var t=this;Se.youtube._dropDown(t,e,function(e,n){t.wysiwygEditorInsertHtml(Ce("youtube",{id:e,time:n}))})},tooltip:"Insert a YouTube video"},date:{_date:function(e){var t=new Date,n=t.getYear(),o=t.getMonth()+1,i=t.getDate();return n<2e3&&(n=1900+n),o<10&&(o="0"+o),i<10&&(i="0"+i),e.opts.dateFormat.replace(/year/i,n).replace(/month/i,o).replace(/day/i,i)},exec:function(){this.insertText(Se.date._date(this))},txtExec:function(){this.insertText(Se.date._date(this))},tooltip:"Insert current date"},time:{_time:function(){var e=new Date,t=e.getHours(),n=e.getMinutes(),o=e.getSeconds();return t<10&&(t="0"+t),n<10&&(n="0"+n),o<10&&(o="0"+o),t+":"+n+":"+o},exec:function(){this.insertText(Se.time._time())},txtExec:function(){this.insertText(Se.time._time())},tooltip:"Insert current time"},ltr:{state:function(e,t){return t&&"ltr"===t.style.direction},exec:function(){var e=this,t=e.getRangeHelper(),n=t.getFirstBlockParent();e.focus(),(n&&!C(n,"body")||(e.execCommand("formatBlock","p"),(n=t.getFirstBlockParent())&&!C(n,"body")))&&w(n,"direction","ltr"===w(n,"direction")?"":"ltr")},tooltip:"Left-to-Right"},rtl:{state:function(e,t){return t&&"rtl"===t.style.direction},exec:function(){var e=this,t=e.getRangeHelper(),n=t.getFirstBlockParent();e.focus(),(n&&!C(n,"body")||(e.execCommand("formatBlock","p"),(n=t.getFirstBlockParent())&&!C(n,"body")))&&w(n,"direction","rtl"===w(n,"direction")?"":"rtl")},tooltip:"Right-to-Left"},print:{exec:"print",tooltip:"Print"},maximize:{state:function(){return this.maximize()},exec:function(){this.maximize(!this.maximize())},txtExec:function(){this.maximize(!this.maximize())},tooltip:"Maximize",shortcut:"Ctrl+Shift+M"},source:{state:function(){return this.sourceMode()},exec:function(){this.toggleSourceMode()},txtExec:function(){this.toggleSourceMode()},tooltip:"View source",shortcut:"Ctrl+Shift+S"},ignore:{}},Te={};ee.plugins=Te;var De=de&&de<11,Me=function(e,t,n){var o,i,r,l,a,s="",c=e.startContainer,u=e.startOffset;for(c&&3!==c.nodeType&&(c=c.childNodes[u],u=0),r=l=u;n>s.length&&c&&3===c.nodeType;)o=c.nodeValue,i=n-s.length,a&&(l=o.length,r=0),a=c,t?(u=r=Math.max(l-i,0),s=o.substr(r,l-r)+s,c=a.previousSibling):(u=r+(l=Math.min(i,o.length)),s+=o.substr(r,l),c=a.nextSibling);return{node:a||c,offset:u,text:s}},Ne=window,Be=document,Re=de,Fe=Re&&Re<11,He=/^image\/(p?jpe?g|gif|png|bmp)$/i;re.locale={},re.command={get:function(e){return Se[e]||null},set:function(e,t){return!(!e||!t)&&(t=o(Se[e]||{},t),t.remove=function(){re.command.remove(e)},Se[e]=t,this)},remove:function(e){return Se[e]&&delete Se[e],this}},window.sceditor={command:re.command,commands:Se,defaultOptions:xe,ie:de,ios:pe,isWysiwygSupported:he,regexEscape:G,escapeEntities:J,escapeUriScheme:function(e){var t,n=/^[^\/]*:/i,o=window.location;return e&&n.test(e)&&!we.test(e)?((t=o.pathname.split("/")).pop(),o.protocol+"//"+o.host+t.join("/")+"/"+e):e},dom:{css:w,attr:g,removeAttr:v,is:C,closest:u,width:F,height:H,traverse:_,rTraverse:A,parseHTML:L,hasStyling:W,convertElement:j,blockLevelList:ye,canHaveChildren:P,isInline:q,copyCSS:V,fixNesting:$,findCommonAncestor:function(e,t){for(;e=e.parentNode;)if(E(e,t))return e},getSibling:U,removeWhiteSpace:Q,extractContents:Y,getOffset:K,getStyle:X,hasStyle:function(e,t,n){var o=X(e,t);return!!o&&(!n||o===n||Array.isArray(n)&&n.indexOf(o)>-1)}},utils:{each:r,isEmptyObject:n,extend:o},plugins:ee.plugins,create:function(e,t){t=t||{},c(e,".sceditor-container")||(t.runWithoutWysiwygSupport||he)&&new re(e,t)},instance:function(e){return e._sceditor}},e.sceditor=window.sceditor,e.fn.sceditor=function(t){var n,o=[];return this.each(function(){n=this._sceditor,"state"===t?o.push(!!n):"instance"===t?o.push(n):n||e.sceditor.create(this,t)}),o.length?1===o.length?o[0]:o:this}}(jQuery),function(e,t){"use strict";var n=e.plugins,o=e.escapeEntities,i=e.escapeUriScheme,r=e.dom,l=e.utils,a=r.css,s=r.attr,c=r.is,u=l.extend,d=l.each,f=e.ie,p=f&&f<11,h=e.command.get,m={bold:{txtExec:["[b]","[/b]"]},italic:{txtExec:["[i]","[/i]"]},underline:{txtExec:["[u]","[/u]"]},strike:{txtExec:["[s]","[/s]"]},subscript:{txtExec:["[sub]","[/sub]"]},superscript:{txtExec:["[sup]","[/sup]"]},left:{txtExec:["[left]","[/left]"]},center:{txtExec:["[center]","[/center]"]},right:{txtExec:["[right]","[/right]"]},justify:{txtExec:["[justify]","[/justify]"]},font:{txtExec:function(e){var t=this;h("font")._dropDown(t,e,function(e){t.insertText("[font="+e+"]","[/font]")})}},size:{txtExec:function(e){var t=this;h("size")._dropDown(t,e,function(e){t.insertText("[size="+e+"]","[/size]")})}},color:{txtExec:function(e){var t=this;h("color")._dropDown(t,e,function(e){t.insertText("[color="+e+"]","[/color]")})}},bulletlist:{txtExec:function(e,t){var n="";d(t.split(/\r?\n/),function(){n+=(n?"\n":"")+"[li]"+this+"[/li]"}),this.insertText("[ul]\n"+n+"\n[/ul]")}},orderedlist:{txtExec:function(e,t){var o="";d(t.split(/\r?\n/),function(){o+=(o?"\n":"")+"[li]"+this+"[/li]"}),n.bbcode.bbcode.get(""),this.insertText("[ol]\n"+o+"\n[/ol]")}},table:{txtExec:["[table][tr][td]","[/td][/tr][/table]"]},horizontalrule:{txtExec:["[hr]"]},code:{txtExec:["[code]","[/code]"]},image:{txtExec:function(e,t){var n=this;h("image")._dropDown(n,e,t,function(e,t,o){var i="";t&&(i+=" width="+t),o&&(i+=" height="+o),n.insertText("[img"+i+"]"+e+"[/img]")})}},email:{txtExec:function(e,t){var n=this;h("email")._dropDown(n,e,function(e,o){n.insertText("[email="+e+"]"+(o||t||e)+"[/email]")})}},link:{txtExec:function(e,t){var n=this;h("link")._dropDown(n,e,function(e,o){n.insertText("[url="+e+"]"+(o||t||e)+"[/url]")})}},quote:{txtExec:["[quote]","[/quote]"]},youtube:{txtExec:function(e){var t=this;h("youtube")._dropDown(t,e,function(e){t.insertText("[youtube]"+e+"[/youtube]")})}},rtl:{txtExec:["[rtl]","[/rtl]"]},ltr:{txtExec:["[ltr]","[/ltr]"]}},g=function(e){return"function"==typeof e},v=function(e){return e?e.replace(/\\(.)/g,"$1").replace(/^(["'])(.*?)\1$/,"$2"):e},b=function(){var e=arguments;return e[0].replace(/\{(\d+)\}/g,function(t,n){return void 0!==e[n-0+1]?e[n-0+1]:"{"+n+"}"})},y=function(e,t,n,o,i,r){var l=this;l.type=e,l.name=t,l.val=n,l.attrs=o||{},l.children=i||[],l.closing=r||null};y.prototype={clone:function(){var e=this;return new y(e.type,e.name,e.val,u({},e.attrs),[],e.closing?e.closing.clone():null)},splitAt:function(e){var t,n=this,o=n.clone(),i=n.children.indexOf(e);return i>-1&&(t=n.children.length-i,o.children=n.children.splice(i,t)),o}};var x=function(e){var t,i,r,l,a,s,c,d,f,h,m,b,w,k,C=this;t=function(){C.bbcodes=n.bbcode.bbcodes,C.opts=u({},x.defaults,e)},C.tokenize=function(e){var t,n,o,r=[],l=[{type:"close",regex:/^\[\/[^\[\]]+\]/},{type:"open",regex:/^\[[^\[\]]+\]/},{type:"newline",regex:/^(\r\n|\r|\n)/},{type:"content",regex:/^([^\[\r\n]+|\[)/}];l.reverse();e:for(;e.length;){for(o=l.length;o--;)if(n=l[o].type,(t=e.match(l[o].regex))&&t[0]){r.push(i(n,t[0])),e=e.substr(t[0].length);continue e}e.length&&r.push(i("content",e)),e=""}return r},i=function(e,t){var n,o,i,l=/\[([^\]\s=]+)(?:([^\]]+))?\]/,a=/\[\/([^\[\]]+)\]/;return"open"===e&&(n=t.match(l))&&(i=w(n[1]),n[2]&&(n[2]=n[2].trim())&&(o=r(n[2]))),"close"===e&&(n=t.match(a))&&(i=w(n[1])),"newline"===e&&(i="#newline"),i&&("open"!==e&&"close"!==e||C.bbcodes[i])||(e="content",i="#"),new y(e,i,t,o)},r=function(e){var t,n=/([^\s=]+)=(?:(?:(["'])((?:\\\2|[^\2])*?)\2)|((?:.(?!\s\S+=))*.))/g,o={};if("="===e.charAt(0)&&e.indexOf("=",1)<0)o.defaultattr=v(e.substr(1));else for("="===e.charAt(0)&&(e="defaultattr"+e);t=n.exec(e);)o[w(t[1])]=v(t[3])||t[4];return o},C.parse=function(e,t){var n=l(C.tokenize(e)),o=C.opts;return o.fixInvalidNesting&&s(n),a(n,null,t),o.removeEmptyTags&&d(n),n},m=function(e,t,n){for(var o=n.length;o--;)if(n[o].type===t&&n[o].name===e)return!0;return!1},c=function(e,t){var n=(e?C.bbcodes[e.name]:{}).allowedChildren;return!C.opts.fixInvalidChildren||!n||n.indexOf(t.name||"#")>-1},l=function(e){for(var t,n,o,i,r,l,a=[],s=[],u=[],d=function(){return k(u)},f=function(e){d()?d().children.push(e):s.push(e)},p=function(e){return d()&&(n=C.bbcodes[d().name])&&n.closedBy&&n.closedBy.indexOf(e)>-1};t=e.shift();)switch(l=e[0],c(d(),t)||"close"===t.type&&d()&&t.name===d().name||(t.name="#",t.type="content"),t.type){case"open":p(t.name)&&u.pop(),f(t),(n=C.bbcodes[t.name])&&!n.isSelfClosing&&(n.closedBy||m(t.name,"close",e))?u.push(t):n&&n.isSelfClosing||(t.type="content");break;case"close":if(d()&&t.name!==d().name&&p("/"+t.name)&&u.pop(),d()&&t.name===d().name)d().closing=t,u.pop();else if(m(t.name,"open",u)){for(;o=u.pop();){if(o.name===t.name){o.closing=t;break}i=o.clone(),a.length&&i.children.push(k(a)),a.push(i)}for(l&&"newline"===l.type&&(n=C.bbcodes[t.name])&&!1===n.isInline&&(f(l),e.shift()),f(k(a)),r=a.length;r--;)u.push(a[r]);a.length=0}else t.type="content",f(t);break;case"newline":d()&&l&&p(("close"===l.type?"/":"")+l.name)&&("close"===l.type&&l.name===d().name||((n=C.bbcodes[d().name])&&n.breakAfter?u.pop():n&&!1===n.isInline&&C.opts.breakAfterBlock&&!1!==n.breakAfter&&u.pop())),f(t);break;default:f(t)}return s},a=function(e,t,n){var o,i,r,l,s,c,u,d,f=e.length;t&&(l=C.bbcodes[t.name]);for(var p=f;p--;)if(o=e[p])if("newline"===o.type){if(i=p>0?e[p-1]:null,r=p<f-1?e[p+1]:null,d=!1,!n&&l&&!0!==l.isSelfClosing&&(i?c||r||(!1===l.isInline&&C.opts.breakEndBlock&&!1!==l.breakEnd&&(d=!0),l.breakEnd&&(d=!0),c=d):(!1===l.isInline&&C.opts.breakStartBlock&&!1!==l.breakStart&&(d=!0),l.breakStart&&(d=!0))),i&&"open"===i.type&&(s=C.bbcodes[i.name])&&(n?!1===s.isInline&&(d=!0):(!1===s.isInline&&C.opts.breakAfterBlock&&!1!==s.breakAfter&&(d=!0),s.breakAfter&&(d=!0))),!n&&!u&&r&&"open"===r.type&&(s=C.bbcodes[r.name])&&(!1===s.isInline&&C.opts.breakBeforeBlock&&!1!==s.breakBefore&&(d=!0),s.breakBefore&&(d=!0),u=d,d)){e.splice(p,1);continue}d&&e.splice(p,1),u=!1}else"open"===o.type&&a(o.children,o,n)},s=function(e,t,n,o){var i,r,l,a,u,d,f=function(e){var t=C.bbcodes[e.name];return!t||!1!==t.isInline};for(t=t||[],o=o||e,r=0;r<e.length;r++)if((i=e[r])&&"open"===i.type){if(n&&!f(i)){if(l=k(t),d=l.splitAt(i),u=t.length>1?t[t.length-2].children:o,c(i,l)){var p=l.clone();p.children=i.children,i.children=[p]}if((a=u.indexOf(l))>-1){d.children.splice(0,1),u.splice(a+1,0,i,d);var h=d.children[0];return void(h&&"newline"===h.type&&(f(i)||(d.children.splice(0,1),u.splice(a+2,0,h))))}}t.push(i),s(i.children,t,n||f(i),o),t.pop(i)}},d=function(e){for(var t,n,o=e.length;o--;)(t=e[o])&&"open"===t.type&&(n=C.bbcodes[t.name],d(t.children),function(e){for(var t=e.length;t--;){var n=e[t].type;if("open"===n||"close"===n)return!1;if("content"===n&&/\S|\u00A0/.test(e[t].val))return!1}return!0}(t.children)&&n&&!n.isSelfClosing&&!n.allowsEmpty&&e.splice.apply(e,[o,1].concat(t.children)))},C.toHTML=function(e,t){return f(C.parse(e,t),!0)},f=function(e,t){var i,r,l,a,s,c,u,d,h=[];for(u=function(e){return!1!==(!e||(void 0!==e.isHtmlInline?e.isHtmlInline:e.isInline))};e.length>0;)if(i=e.shift()){if("open"===i.type)d=i.children[i.children.length-1]||{},r=C.bbcodes[i.name],s=t&&u(r),l=f(i.children,!1),r&&r.html?(u(r)||!u(C.bbcodes[d.name])||r.isPreFormatted||r.skipLastLineBreak||p||(l+="<br />"),g(r.html)?a=r.html.call(C,i,i.attrs,l):(i.attrs[0]=l,a=n.bbcode.formatBBCodeString(r.html,i.attrs))):a=i.val+l+(i.closing?i.closing.val:"");else{if("newline"===i.type){if(!t){h.push("<br />");continue}c||h.push("<div>"),p||h.push("<br />"),e.length||h.push("<br />"),h.push("</div>\n"),c=!1;continue}s=t,a=o(i.val,!0)}s&&!c?(h.push("<div>"),c=!0):!s&&c&&(h.push("</div>\n"),c=!1),h.push(a)}return c&&h.push("</div>\n"),h.join("")},C.toBBCode=function(e,t){return h(C.parse(e,t))},h=function(e){for(var t,n,o,i,r,l,a,s,c,u,d=[];e.length>0;)if(t=e.shift())if(o=C.bbcodes[t.name],i=!(!o||!1!==o.isInline),r=o&&o.isSelfClosing,a=i&&C.opts.breakBeforeBlock&&!1!==o.breakBefore||o&&o.breakBefore,s=i&&!r&&C.opts.breakStartBlock&&!1!==o.breakStart||o&&o.breakStart,c=i&&C.opts.breakEndBlock&&!1!==o.breakEnd||o&&o.breakEnd,u=i&&C.opts.breakAfterBlock&&!1!==o.breakAfter||o&&o.breakAfter,l=(o?o.quoteType:null)||C.opts.quoteType||x.QuoteType.auto,o||"open"!==t.type)if("open"===t.type){if(a&&d.push("\n"),d.push("["+t.name),t.attrs){t.attrs.defaultattr&&(d.push("=",b(t.attrs.defaultattr,l,"defaultattr")),delete t.attrs.defaultattr);for(n in t.attrs)t.attrs.hasOwnProperty(n)&&d.push(" ",n,"=",b(t.attrs[n],l,n))}d.push("]"),s&&d.push("\n"),t.children&&d.push(h(t.children)),r||o.excludeClosing||(c&&d.push("\n"),d.push("[/"+t.name+"]")),u&&d.push("\n"),t.closing&&r&&d.push(t.closing.val)}else d.push(t.val);else d.push(t.val),t.children&&d.push(h(t.children)),t.closing&&d.push(t.closing.val);return d.join("")},b=function(e,t,n){var o=x.QuoteType,i=/\s|=/.test(e);return g(t)?t(e,n):t===o.never||t===o.auto&&!i?e:'"'+e.replace("\\","\\\\").replace('"','\\"')+'"'},k=function(e){return e.length?e[e.length-1]:null},w=function(e){return e.toLowerCase()},t()};x.QuoteType={always:1,never:2,auto:3},x.defaults={breakBeforeBlock:!1,breakStartBlock:!1,breakEndBlock:!1,breakAfterBlock:!0,removeEmptyTags:!0,fixInvalidNesting:!0,fixInvalidChildren:!0,quoteType:x.QuoteType.auto},n.bbcode=function(){var e,o,i,l,f=this;f.bbcodes=n.bbcode.bbcodes,f.stripQuotes=v;var h={},y={},w={ul:["li","ol","ul"],ol:["li","ol","ul"],table:["tr"],tr:["td","th"],code:["br","p","div"]};f.init=function(){f.opts=this.opts,e(),this.commands=u(!0,{},m,this.commands),this.toBBCode=f.signalToSource,this.fromBBCode=f.signalToWysiwyg},e=function(){d(f.bbcodes,function(e){var t,n=f.bbcodes[e].tags,o=f.bbcodes[e].styles;n&&d(n,function(n,o){t=!1===f.bbcodes[e].isInline,h[n]=h[n]||{},h[n][t]=h[n][t]||{},h[n][t][e]=o}),o&&d(o,function(n,o){t=!1===f.bbcodes[e].isInline,y[t]=y[t]||{},y[t][n]=y[t][n]||{},y[t][n][e]=o})})},o=function(e,t,n){var o,i,l=r.getStyle;return n=!!n,y[n]?(d(y[n],function(n,r){(o=l(e,n))&&l(e.parentNode,n)!==o&&d(r,function(n,r){(!r||r.indexOf(o.toString())>-1)&&(i=f.bbcodes[n].format,t=g(i)?i.call(f,e,t):b(i,t))})}),t):t},i=function(e,t,n){var o,i,l=e.nodeName.toLowerCase();n=!!n,h[l]&&h[l][n]&&d(h[l][n],function(n,r){r&&(o=!1,d(r,function(t,n){if(s(e,t)&&!(n&&n.indexOf(s(e,t))<0))return o=!0,!1}),!o)||(i=f.bbcodes[n].format,t=g(i)?i.call(f,e,t):b(i,t))});var a=r.isInline;if(n&&(!a(e,!0)||"br"===l)){for(var u,m,v=e.previousSibling;v&&1===v.nodeType&&!c(v,"br")&&a(v,!0)&&!v.firstChild;)v=v.previousSibling;do{u=(m=e.parentNode).lastChild===e,e=m}while(m&&u&&a(m,!0));(!u||"li"===l||"br"===l&&p)&&(t+="\n"),"br"!==l&&v&&!c(v,"br")&&a(v,!0)&&(t="\n"+t)}return t},f.signalToSource=function(e,n){var o,i,l=new x(f.opts.parserOptions);if(n||("string"==typeof e?(o=!0,(n=t.createElement("div")).innerHTML=e,a(n,"visibility","hidden"),t.body.appendChild(n)):n=e),!n)return"";r.removeWhiteSpace(n);for(var s=n.getElementsByClassName("sceditor-ignore");s.length;)s[0].parentNode.removeChild(s[0]);return i=f.elementToBbcode(n),o&&t.body.removeChild(n),i=l.toBBCode(i,!0),f.opts.bbcodeTrim&&(i=i.trim()),i},f.elementToBbcode=function(e){var t=function(e,n){var l="";return r.traverse(e,function(e){var r="",a=e.nodeType,u=e.nodeName.toLowerCase(),d=w[u],f=e.firstChild,h=!0;if("object"==typeof n&&(h=n.indexOf(u)>-1,c(e,"img")&&s(e,"data-sceditor-emoticon")&&(h=!0),h||(d=n)),3===a||1===a)if(1===a){if(c(e,".sceditor-nlf")&&(!f||!p&&1===e.childNodes.length&&/br/i.test(f.nodeName)))return;"iframe"!==u&&(r=t(e,d)),h?("code"!==u&&(r=o(e,r),r=i(e,r),r=o(e,r,!0)),l+=i(e,r,!0)):l+=r}else l+=e.nodeValue},!1,!0),l};return t(e)},f.signalToWysiwyg=function(e,t){var n=new x(f.opts.parserOptions).toHTML(f.opts.bbcodeTrim?e.trim():e);return t?l(n):n},l=function(e){var n,o,i,l=t.createElement("div");return i=function(e,n){if(!r.hasStyling(e)){if(p||1!==e.childNodes.length||!c(e.firstChild,"br"))for(;o=e.firstChild;)l.insertBefore(o,e);if(n){var i=l.lastChild;e!==i&&c(i,"div")&&e.nextSibling===i&&l.insertBefore(t.createElement("br"),e)}l.removeChild(e)}},a(l,"display","none"),l.innerHTML=e.replace(/<\/div>\n/g,"</div>"),(n=l.firstChild)&&c(n,"div")&&i(n,!0),(n=l.lastChild)&&c(n,"div")&&i(n),l.innerHTML}},n.bbcode.formatBBCodeString=function(e,t){return e.replace(/\{([^}]+)\}/g,function(e,n){var i=!0;return"!"===n.charAt(0)&&(i=!1,n=n.substring(1)),"0"===n&&(i=!1),void 0===t[n]?e:i?o(t[n],!0):t[n]})};var w=function(e){return e=parseInt(e,10),isNaN(e)?"00":(e=Math.max(0,Math.min(e,255)).toString(16),e.length<2?"0"+e:e)},k=function(e){var t;return e=e||"#000",(t=e.match(/rgb\((\d{1,3}),\s*?(\d{1,3}),\s*?(\d{1,3})\)/i))?"#"+w(t[1])+w(t[2]-0)+w(t[3]-0):(t=e.match(/#([0-f])([0-f])([0-f])\s*?$/i))?"#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]:e},C={b:{tags:{b:null,strong:null},styles:{"font-weight":["bold","bolder","401","700","800","900"]},format:"[b]{0}[/b]",html:"<strong>{0}</strong>"},i:{tags:{i:null,em:null},styles:{"font-style":["italic","oblique"]},format:"[i]{0}[/i]",html:"<em>{0}</em>"},u:{tags:{u:null},styles:{"text-decoration":["underline"]},format:"[u]{0}[/u]",html:"<u>{0}</u>"},s:{tags:{s:null,strike:null},styles:{"text-decoration":["line-through"]},format:"[s]{0}[/s]",html:"<s>{0}</s>"},sub:{tags:{sub:null},format:"[sub]{0}[/sub]",html:"<sub>{0}</sub>"},sup:{tags:{sup:null},format:"[sup]{0}[/sup]",html:"<sup>{0}</sup>"},font:{tags:{font:{face:null}},styles:{"font-family":null},quoteType:x.QuoteType.never,format:function(e,t){var n;return c(e,"font")&&(n=s(e,"face"))||(n=a(e,"font-family")),"[font="+v(n)+"]"+t+"[/font]"},html:'<font face="{defaultattr}">{0}</font>'},size:{tags:{font:{size:null}},styles:{"font-size":null},format:function(e,t){var n=s(e,"size"),o=2;return n||(n=a(e,"fontSize")),n.indexOf("px")>-1?((n=n.replace("px","")-0)<12&&(o=1),n>15&&(o=3),n>17&&(o=4),n>23&&(o=5),n>31&&(o=6),n>47&&(o=7)):o=n,"[size="+o+"]"+t+"[/size]"},html:'<font size="{defaultattr}">{!0}</font>'},color:{tags:{font:{color:null}},styles:{color:null},quoteType:x.QuoteType.never,format:function(e,t){var n;return c(e,"font")&&(n=s(e,"color"))||(n=e.style.color||e.css(e,"color")),"[color="+k(n)+"]"+t+"[/color]"},html:function(e,t,n){return'<font color="'+o(k(t.defaultattr),!0)+'">'+n+"</font>"}},ul:{tags:{ul:null},breakStart:!0,isInline:!1,skipLastLineBreak:!0,format:"[ul]{0}[/ul]",html:"<ul>{0}</ul>"},list:{breakStart:!0,isInline:!1,skipLastLineBreak:!0,html:"<ul>{0}</ul>"},ol:{tags:{ol:null},breakStart:!0,isInline:!1,skipLastLineBreak:!0,format:"[ol]{0}[/ol]",html:"<ol>{0}</ol>"},li:{tags:{li:null},isInline:!1,closedBy:["/ul","/ol","/list","*","li"],format:"[li]{0}[/li]",html:"<li>{0}</li>"},"*":{isInline:!1,closedBy:["/ul","/ol","/list","*","li"],html:"<li>{0}</li>"},table:{tags:{table:null},isInline:!1,isHtmlInline:!0,skipLastLineBreak:!0,format:"[table]{0}[/table]",html:"<table>{0}</table>"},tr:{tags:{tr:null},isInline:!1,skipLastLineBreak:!0,format:"[tr]{0}[/tr]",html:"<tr>{0}</tr>"},th:{tags:{th:null},allowsEmpty:!0,isInline:!1,format:"[th]{0}[/th]",html:"<th>{0}</th>"},td:{tags:{td:null},allowsEmpty:!0,isInline:!1,format:"[td]{0}[/td]",html:"<td>{0}</td>"},emoticon:{allowsEmpty:!0,tags:{img:{src:null,"data-sceditor-emoticon":null}},format:function(e,t){return s(e,"data-sceditor-emoticon")+t},html:"{0}"},hr:{tags:{hr:null},allowsEmpty:!0,isSelfClosing:!0,isInline:!1,format:"[hr]{0}",html:"<hr />"},img:{allowsEmpty:!0,tags:{img:{src:null}},allowedChildren:["#"],quoteType:x.QuoteType.never,format:function(e,t){var n,o,i="",l=function(t){return e.style?e.style[t]:null};return s(e,"data-sceditor-emoticon")?t:(n=s(e,"width")||l("width"),o=s(e,"height")||l("height"),(e.complete&&(n||o)||n&&o)&&(i="="+r.width(e)+"x"+r.height(e)),"[img"+i+"]"+s(e,"src")+"[/img]")},html:function(e,t,n){var r,l,a,s="";return r=t.width,l=t.height,t.defaultattr&&(r=(a=t.defaultattr.split(/x/i))[0],l=2===a.length?a[1]:a[0]),void 0!==r&&(s+=' width="'+o(r,!0)+'"'),void 0!==l&&(s+=' height="'+o(l,!0)+'"'),"<img"+s+' src="'+i(n)+'" />'}},url:{allowsEmpty:!0,tags:{a:{href:null}},quoteType:x.QuoteType.never,format:function(e,t){var n=s(e,"href");return"mailto:"===n.substr(0,7)?'[email="'+n.substr(7)+'"]'+t+"[/email]":"[url="+n+"]"+t+"[/url]"},html:function(e,t,n){return t.defaultattr=o(t.defaultattr,!0)||n,'<a href="'+i(t.defaultattr)+'">'+n+"</a>"}},email:{quoteType:x.QuoteType.never,html:function(e,t,n){return'<a href="mailto:'+(o(t.defaultattr,!0)||n)+'">'+n+"</a>"}},quote:{tags:{blockquote:null},isInline:!1,quoteType:x.QuoteType.never,format:function(e,t){for(var n,o="",i=e.children,r=0;!n&&r<i.length;r++)c(i[r],"cite")&&(n=i[r]);return(n||s(e,"data-author"))&&(o=n.textContent||s(e,"data-author"),s(e,"data-author",o),n&&e.removeChild(n),t=this.elementToBbcode(e),o="="+o.replace(/(^\s+|\s+$)/g,""),n&&e.insertBefore(n,e.firstChild)),"[quote"+o+"]"+t+"[/quote]"},html:function(e,t,n){return t.defaultattr&&(n="<cite>"+o(t.defaultattr)+"</cite>"+n),"<blockquote>"+n+"</blockquote>"}},code:{tags:{code:null},isInline:!1,allowedChildren:["#","#newline"],format:"[code]{0}[/code]",html:"<code>{0}</code>"},left:{styles:{"text-align":["left","-webkit-left","-moz-left","-khtml-left"]},isInline:!1,format:"[left]{0}[/left]",html:'<div align="left">{0}</div>'},center:{styles:{"text-align":["center","-webkit-center","-moz-center","-khtml-center"]},isInline:!1,format:"[center]{0}[/center]",html:'<div align="center">{0}</div>'},right:{styles:{"text-align":["right","-webkit-right","-moz-right","-khtml-right"]},isInline:!1,format:"[right]{0}[/right]",html:'<div align="right">{0}</div>'},justify:{styles:{"text-align":["justify","-webkit-justify","-moz-justify","-khtml-justify"]},isInline:!1,format:"[justify]{0}[/justify]",html:'<div align="justify">{0}</div>'},youtube:{allowsEmpty:!0,tags:{iframe:{"data-youtube-id":null}},format:function(e,t){return e=s(e,"data-youtube-id"),e?"[youtube]"+e+"[/youtube]":t},html:'<iframe width="560" height="315" frameborder="0" src="https://www.youtube.com/embed/{0}?wmode=opaque" data-youtube-id="{0}" allowfullscreen></iframe>'},rtl:{styles:{direction:["rtl"]},format:"[rtl]{0}[/rtl]",html:'<div style="direction: rtl">{0}</div>'},ltr:{styles:{direction:["ltr"]},format:"[ltr]{0}[/ltr]",html:'<div style="direction: ltr">{0}</div>'},ignore:{}};n.bbcode.bbcode={get:function(e){return C[e]||null},set:function(e,t){return!(!e||!t)&&(t=u(C[e]||{},t),t.remove=function(){delete C[e]},C[e]=t,this)},rename:function(e,t){return e in C&&(C[t]=C[e],delete C[e],this)},remove:function(e){return e in C&&delete C[e],this}},n.bbcode.normaliseColour=k,n.bbcode.formatString=b,n.bbcode.stripQuotes=v,n.bbcode.bbcodes=C,e.BBCodeParser=x}(sceditor,document);